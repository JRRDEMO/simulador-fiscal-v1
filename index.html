<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Herramienta de Planificaci√≥n Fiscal SPEGC</title>
    <meta name="description" content="Herramienta profesional de planificaci√≥n fiscal para empresas en Gran Canaria">
    <meta name="theme-color" content="#005B9A">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìä</text></svg>">
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Open+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <!-- Disclaimer Modal -->
    <div id="disclaimerModal" class="modal modal--disclaimer">
        <div class="modal-content">
            <div class="disclaimer-header">
                <h2>‚ö†Ô∏è Aviso de Responsabilidad</h2>
            </div>
            <div class="disclaimer-content">
                <p><strong>IMPORTANTE:</strong> Esta herramienta es meramente orientativa y no constituye asesoramiento fiscal profesional.</p>
                <p>Los resultados obtenidos no garantizan el cumplimiento de los requisitos legales ni la aplicaci√≥n efectiva de los incentivos fiscales.</p>
                <p>Se recomienda encarecidamente consultar con un asesor fiscal especializado antes de tomar decisiones basadas en esta simulaci√≥n.</p>
                <p><strong>SPEGC</strong> no se hace responsable de las decisiones tomadas bas√°ndose √∫nicamente en los resultados de esta herramienta.</p>
            </div>
            <div class="disclaimer-footer">
                <label class="disclaimer-accept">
                    <input type="checkbox" id="disclaimerAccept" required>
                    <span>He le√≠do y acepto las condiciones de uso</span>
                </label>
                <button class="btn btn--primary" id="disclaimerContinue" disabled>Continuar</button>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header__content">
                <div class="header__logo">
                    <div class="logo-container">
                        <div class="logo-icon">üìä</div>
                        <div class="logo-text">
                            <h1 class="header__title">HERRAMIENTA FISCAL SPEGC</h1>
                            <p class="header__subtitle">Best in Gran Canaria</p>
                        </div>
                    </div>
                </div>
                <nav class="header__nav">
                    <button class="btn btn--ghost" id="aboutBtn">
                        <span class="btn-icon">‚ÑπÔ∏è</span>
                        <span>Acerca de</span>
                    </button>
                    <button class="btn btn--ghost" id="helpBtn">
                        <span class="btn-icon">‚ùì</span>
                        <span>Ayuda</span>
                    </button>
                    <button class="btn btn--ghost" id="legalBtn">
                        <span class="btn-icon">‚öñÔ∏è</span>
                        <span>Legal</span>
                    </button>
                </nav>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main">
        <!-- Landing Section -->
        <section id="landingSection" class="section section--landing">
            <div class="container">
                <div class="landing__content">
                    <div class="landing__hero">
                        <h2 class="landing__title">Planificaci√≥n Fiscal Inteligente</h2>
                        <p class="landing__description">
                            Herramienta profesional PWA para optimizar incentivos fiscales en Gran Canaria.
                            C√°lculos precisos, an√°lisis avanzados y planificaci√≥n multi-anual.
                        </p>
                    </div>
                    
                    <div class="landing__features">
                        <div class="feature-card">
                            <div class="feature-card__icon">üéØ</div>
                            <h3>ZEC Autom√°tico</h3>
                            <p>Evaluaci√≥n autom√°tica de elegibilidad ZEC para Gran Canaria</p>
                        </div>
                        <div class="feature-card">
                            <div class="feature-card__icon">üìà</div>
                            <h3>An√°lisis Multi-anual</h3>
                            <p>Planificaci√≥n hasta 5 a√±os con gr√°ficos waterfall</p>
                        </div>
                        <div class="feature-card">
                            <div class="feature-card__icon">‚öôÔ∏è</div>
                            <h3>C√°lculos Avanzados</h3>
                            <p>RIC, DIC, I+D+i y Audiovisual con compatibilidades</p>
                        </div>
                        <div class="feature-card">
                            <div class="feature-card__icon">üì±</div>
                            <h3>PWA Offline</h3>
                            <p>Instalable y funcional sin conexi√≥n a internet</p>
                        </div>
                    </div>

                    <div class="landing__actions">
                        <button class="btn btn--primary btn--lg" id="newProjectBtn">
                            <span class="btn-icon">‚ûï</span>
                            <span>Nuevo Proyecto</span>
                        </button>
                        <button class="btn btn--outline btn--lg" id="loadProjectBtn">
                            <span class="btn-icon">üìÇ</span>
                            <span>Cargar Proyecto</span>
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Configuration Section -->
        <section id="configSection" class="section section--config hidden">
            <div class="container">
                <div class="config-container">
                    <div class="section-header">
                        <h2>Configuraci√≥n del Proyecto</h2>
                        <p>Define los par√°metros b√°sicos para tu planificaci√≥n fiscal en Gran Canaria</p>
                    </div>
                    
                    <form id="projectConfigForm" class="config-form">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label" for="projectName">
                                    <span>Nombre del Proyecto</span>
                                    <span class="tooltip" data-tip="Identificador √∫nico para tu proyecto">?</span>
                                </label>
                                <input type="text" id="projectName" class="form-control" required placeholder="Ej: Expansi√≥n Tecnol√≥gica 2025">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="projectType">
                                    <span>Tipo de Proyecto</span>
                                    <span class="tooltip" data-tip="Determina qu√© incentivos estar√°n disponibles">?</span>
                                </label>
                                <select id="projectType" class="form-control" required>
                                    <option value="">Seleccione un tipo</option>
                                    <option value="general">Proyecto General</option>
                                    <option value="idi">I+D+i</option>
                                    <option value="audiovisual">Audiovisual</option>
                                    <option value="complete">An√°lisis Completo</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="planningYears">
                                    <span>A√±os a Planificar</span>
                                    <span class="tooltip" data-tip="Horizonte temporal para la planificaci√≥n fiscal">?</span>
                                </label>
                                <select id="planningYears" class="form-control" required>
                                    <option value="1">1 a√±o</option>
                                    <option value="2">2 a√±os</option>
                                    <option value="3" selected>3 a√±os</option>
                                    <option value="4">4 a√±os</option>
                                    <option value="5">5 a√±os</option>
                                </select>
                            </div>

                            <div class="form-group form-group--info">
                                <div class="info-card">
                                    <div class="info-card__icon">üèùÔ∏è</div>
                                    <div class="info-card__content">
                                        <h4>Configurado para Gran Canaria</h4>
                                        <p>ZEC: Inversi√≥n m√≠n. ‚Ç¨100,000 ‚Ä¢ Empleo m√≠n. 5 puestos ‚Ä¢ L√≠mite deducciones: 60%</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" class="btn btn--outline" id="backToLandingBtn">
                                <span class="btn-icon">‚Üê</span>
                                <span>Volver</span>
                            </button>
                            <button type="submit" class="btn btn--primary">
                                <span>Continuar</span>
                                <span class="btn-icon">‚Üí</span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </section>

        <!-- Planning Section -->
        <section id="planningSection" class="section section--planning hidden">
            <div class="container">
                <div class="planning-header">
                    <div class="planning-header__title">
                        <h2 id="planningTitle">Planificaci√≥n Fiscal</h2>
                        <div class="planning-header__breadcrumb">
                            <span>Configuraci√≥n</span>
                            <span class="breadcrumb-separator">‚Üí</span>
                            <span class="breadcrumb-current">Planificaci√≥n</span>
                            <span class="breadcrumb-separator">‚Üí</span>
                            <span>Resultados</span>
                        </div>
                    </div>
                    <div class="planning-nav">
                        <button class="btn btn--sm btn--outline" id="prevYearBtn" disabled>
                            <span class="btn-icon">‚Üê</span>
                            <span>Anterior</span>
                        </button>
                        <span class="year-indicator" id="currentYearDisplay">A√±o 1</span>
                        <button class="btn btn--sm btn--outline" id="nextYearBtn">
                            <span>Siguiente</span>
                            <span class="btn-icon">‚Üí</span>
                        </button>
                    </div>
                </div>

                <!-- ZEC Status Card -->
                <div class="card zec-card">
                    <div class="card__header">
                        <div class="card-title">
                            <h3>üéØ Evaluaci√≥n ZEC - Gran Canaria</h3>
                            <div class="status-badge" id="zecStatus">Evaluando...</div>
                        </div>
                    </div>
                    <div class="card__body">
                        <div class="zec-grid">
                            <div class="zec-criterion">
                                <div class="criterion-icon">üí∞</div>
                                <div class="criterion-content">
                                    <div class="criterion-label">Inversi√≥n M√≠nima</div>
                                    <div class="criterion-value">‚Ç¨100,000</div>
                                </div>
                            </div>
                            <div class="zec-criterion">
                                <div class="criterion-icon">üë•</div>
                                <div class="criterion-content">
                                    <div class="criterion-label">Empleo M√≠nimo</div>
                                    <div class="criterion-value">5 empleados</div>
                                </div>
                            </div>
                            <div class="zec-criterion">
                                <div class="criterion-icon">üìä</div>
                                <div class="criterion-content">
                                    <div class="criterion-label">Tipo Aplicable</div>
                                    <div class="criterion-value" id="zecTaxRate">4% vs 25%</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Dynamic Planning Forms -->
                <div class="planning-forms" id="planningFormsContainer">
                    <!-- Generated dynamically based on project type -->
                </div>

                <div class="planning-actions">
                    <button class="btn btn--outline" id="backToConfigBtn">
                        <span class="btn-icon">‚Üê</span>
                        <span>Configuraci√≥n</span>
                    </button>
                    <button class="btn btn--secondary" id="calculateBtn">
                        <span class="btn-icon">‚ö°</span>
                        <span>Calcular</span>
                    </button>
                    <button class="btn btn--primary hidden" id="viewDashboardBtn">
                        <span>Ver Dashboard</span>
                        <span class="btn-icon">‚Üí</span>
                    </button>
                </div>
            </div>
        </section>

        <!-- Dashboard Section -->
        <section id="dashboardSection" class="section section--dashboard hidden">
            <div class="container">
                <div class="dashboard-header">
                    <div class="dashboard-header__title">
                        <h2>üìä Dashboard de Resultados</h2>
                        <div class="dashboard-breadcrumb">
                            <span>Configuraci√≥n</span>
                            <span class="breadcrumb-separator">‚Üí</span>
                            <span>Planificaci√≥n</span>
                            <span class="breadcrumb-separator">‚Üí</span>
                            <span class="breadcrumb-current">Resultados</span>
                        </div>
                    </div>
                    <div class="dashboard-actions">
                        <button class="btn btn--sm btn--outline" id="exportPdfBtn">
                            <span class="btn-icon">üìÑ</span>
                            <span>PDF</span>
                        </button>
                        <button class="btn btn--sm btn--outline" id="exportCsvBtn">
                            <span class="btn-icon">üìä</span>
                            <span>CSV</span>
                        </button>
                        <button class="btn btn--sm btn--outline" id="saveProjectBtn">
                            <span class="btn-icon">üíæ</span>
                            <span>Guardar</span>
                        </button>
                        <button class="btn btn--sm btn--primary" id="backToPlanningBtn">
                            <span class="btn-icon">‚úèÔ∏è</span>
                            <span>Editar</span>
                        </button>
                    </div>
                </div>

                <!-- Key Metrics -->
                <div class="metrics-section">
                    <div class="metrics-grid">
                        <div class="metric-card metric-card--primary">
                            <div class="metric-card__icon">üí∞</div>
                            <div class="metric-card__content">
                                <div class="metric-value" id="totalSavings">‚Ç¨0</div>
                                <div class="metric-label">Ahorro Total</div>
                            </div>
                        </div>
                        <div class="metric-card metric-card--success">
                            <div class="metric-card__icon">üìà</div>
                            <div class="metric-card__content">
                                <div class="metric-value" id="effectiveRate">0%</div>
                                <div class="metric-label">Tipo Efectivo</div>
                            </div>
                        </div>
                        <div class="metric-card metric-card--info">
                            <div class="metric-card__icon">üéØ</div>
                            <div class="metric-card__content">
                                <div class="metric-value" id="zecEligible">No</div>
                                <div class="metric-label">ZEC Elegible</div>
                            </div>
                        </div>
                        <div class="metric-card metric-card--warning">
                            <div class="metric-card__icon">‚öôÔ∏è</div>
                            <div class="metric-card__content">
                                <div class="metric-value" id="totalIncentives">‚Ç¨0</div>
                                <div class="metric-label">Incentivos</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Waterfall Chart -->
                <div class="card waterfall-card">
                    <div class="card__header">
                        <h3>üìä Gr√°fico Waterfall - C√°lculo Fiscal</h3>
                        <div class="chart-legend">
                            <span class="legend-item">
                                <span class="legend-color legend-color--primary"></span>
                                <span>Resultado Contable</span>
                            </span>
                            <span class="legend-item">
                                <span class="legend-color legend-color--success"></span>
                                <span>Deducciones</span>
                            </span>
                            <span class="legend-item">
                                <span class="legend-color legend-color--error"></span>
                                <span>Cuota Final</span>
                            </span>
                        </div>
                    </div>
                    <div class="card__body">
                        <canvas id="waterfallChart" width="800" height="400"></canvas>
                    </div>
                </div>

                <!-- Charts Grid -->
                <div class="charts-grid">
                    <div class="card">
                        <div class="card__header">
                            <h3>üç∞ Distribuci√≥n de Incentivos</h3>
                        </div>
                        <div class="card__body">
                            <canvas id="incentivesChart" width="400" height="300"></canvas>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card__header">
                            <h3>üìà Evoluci√≥n Multi-anual</h3>
                        </div>
                        <div class="card__body">
                            <canvas id="evolutionChart" width="400" height="300"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Results Table -->
                <div class="card results-card">
                    <div class="card__header">
                        <h3>üìã Resultados Detallados por A√±o</h3>
                        <button class="btn btn--sm btn--outline" id="toggleTableBtn">
                            <span>Expandir</span>
                        </button>
                    </div>
                    <div class="card__body">
                        <div class="table-container">
                            <table class="results-table" id="resultsTable">
                                <thead>
                                    <tr>
                                        <th rowspan="2">A√±o</th>
                                        <th rowspan="2">RC (‚Ç¨)</th>
                                        <th rowspan="2">RIC (‚Ç¨)</th>
                                        <th rowspan="2">BI (‚Ç¨)</th>
                                        <th rowspan="2">CI (‚Ç¨)</th>
                                        <th colspan="4">Deducciones (‚Ç¨)</th>
                                        <th rowspan="2">CL (‚Ç¨)</th>
                                        <th rowspan="2">Ahorro (‚Ç¨)</th>
                                    </tr>
                                    <tr>
                                        <th>DIC</th>
                                        <th>I+D+i</th>
                                        <th>Audio</th>
                                        <th>Total</th>
                                    </tr>
                                </thead>
                                <tbody id="resultsTableBody">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Analysis Panel -->
                <div class="analysis-panel">
                    <div class="card">
                        <div class="card__header">
                            <h3>üîç An√°lisis de Compatibilidades</h3>
                        </div>
                        <div class="card__body">
                            <div id="compatibilityAnalysis"></div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card__header">
                            <h3>‚è∞ Saldos Pendientes (Carry-Forward)</h3>
                        </div>
                        <div class="card__body">
                            <div id="carryForwardAnalysis"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Generic Modal -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle"></h3>
                <button class="modal-close" id="modalCloseBtn">&times;</button>
            </div>
            <div class="modal-body" id="modalContent"></div>
            <div class="modal-footer" id="modalFooter"></div>
        </div>
    </div>

    <!-- Load Project Modal -->
    <div id="loadModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üìÇ Cargar Proyecto</h3>
                <button class="modal-close" id="loadModalCloseBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="file-upload-area" id="fileUploadArea">
                    <div class="file-upload-icon">üìÅ</div>
                    <p>Arrastra un archivo JSON aqu√≠ o haz clic para seleccionar</p>
                    <input type="file" id="fileInput" accept=".json" hidden>
                    <button class="btn btn--outline" id="selectFileBtn">Seleccionar Archivo</button>
                </div>
                <div class="recent-projects" id="recentProjects">
                    <h4>Proyectos Recientes</h4>
                    <div id="recentProjectsList"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toastContainer" class="toast-container"></div>

    <script src="app.js"></script>
</body>
</html>